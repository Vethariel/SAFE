{% extends "base.html" %}
{% load static %}

{% block title %}Mi aprendizaje - SAFE{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'courses/css/catalog.css' %}" />
  <style>
    .section-title { margin: 16px 0 12px; }
    .muted-note { color: var(--safe-ink2); margin-top: 6px; }
  </style>
{% endblock %}

{% block content %}
  <div class="container">
    <h1 class="section-title">Rutas de aprendizaje</h1>
    {% if paths %}
      <div class="courses-grid">
        {% for path in paths %}
          <div class="course-card">
            <div class="course-card-header">
              {% if path.header_img %}
                <img src="{{ path.header_img.url }}" alt="{{ path.name }}">
              {% else %}
                <span class="placeholder-icon">SAFE</span>
              {% endif %}
              <div class="card-badges">
                <span class="status-badge status-{{ path.status }}">{{ path.get_status_display }}</span>
                <span class="pill audience-pill">Ruta</span>
              </div>
            </div>
            <div class="course-card-body">
              <div class="card-header-row">
                <div>
                  <p class="eyebrow">Ruta</p>
                  <h3 class="card-title">{{ path.name }}</h3>
                </div>
                <span class="pill muted-pill">{{ path.courses.count }} curso(s)</span>
              </div>
              <p class="card-description">{{ path.description|default:"Sin descripción" }}</p>
              <div class="card-meta">
                <span class="meta-pill">{{ path.estimated_duration|default:"0" }}h estimadas</span>
                <span class="meta-pill">{{ path.courses.count }} curso(s)</span>
              </div>
              <div class="card-actions">
                <a class="btn-primary" href="{% url 'learning_path_detail' path.id %}">Ver ruta</a>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty-state">
        <p class="empty-text">No hay rutas de aprendizaje configuradas.</p>
      </div>
    {% endif %}

    <h1 class="section-title" style="margin-top:28px;">Mis cursos</h1>
    {% if course_cards %}
      <div class="courses-grid">
        {% for card in course_cards %}
          {% with course=card.course %}
            <div class="course-card">
              <div class="course-card-header">
                {% if course.header_img %}
                  <img src="{{ course.header_img.url }}" alt="{{ course.name }}" />
                {% else %}
                  <span class="placeholder-icon">SAFE</span>
                {% endif %}
                <div class="card-badges">
                  <span class="status-badge status-{{ course.status }}">{{ course.get_status_display }}</span>
                  <span class="pill audience-pill">{{ card.audience_label }}</span>
                </div>
              </div>

              <div class="course-card-body">
                <div class="card-header-row">
                  <div>
                    <p class="eyebrow">Curso</p>
                    <h3 class="card-title">{{ course.name }}</h3>
                  </div>
                  {% if card.inscription_count %}
                    <span class="pill muted-pill">{{ card.inscription_count }} personas inscritas</span>
                  {% endif %}
                </div>

                <p class="card-description">{{ course.description|default:'Sin descripcion' }}</p>

                <div class="card-meta">
                  <span class="meta-pill">{{ card.modules_count|default:'0' }} actividades</span>
                  <span class="meta-pill">{{ course.duration_hours|default:'0' }}h</span>
                  <span class="meta-pill">{{ card.total_contents|default:'0' }} contenidos</span>
                </div>

                <div class="progress-row">
                  <div class="progress-label">
                    {% if card.progress_percent is not None %}
                      {{ card.completed_contents }} / {{ card.total_contents }} contenidos ({{ card.progress_percent|floatformat:0 }}%)
                    {% else %}
                      Progreso no disponible
                    {% endif %}
                  </div>
                  <div class="progress-track">
                    <div class="progress-fill" style="width: {{ card.progress_percent|default:0|floatformat:0 }}%;"></div>
                  </div>
                </div>

                <div class="card-actions">
                  {% if card.can_open %}
                    <a class="btn-primary" href="{% url 'course_detail_accessible' course.id %}">Abrir</a>
                    <a class="btn-secondary" href="{% url 'course_detail_accessible' course.id %}">Más detalles</a>
                  {% else %}
                    <button class="btn-primary btn-disabled" type="button" disabled>No inscrito</button>
                    <span class="eyebrow">Debes estar inscrito para abrir</span>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endwith %}
        {% endfor %}
      </div>
    {% else %}
      <div class="empty-state">
        <p class="empty-text">Aún no tienes cursos visibles.</p>
      </div>
    {% endif %}
  </div>
{% endblock %}

