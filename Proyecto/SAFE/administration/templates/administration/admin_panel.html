{% extends 'base.html' %}
{% load static %}

{% block title %}
  Administración — SAFE
{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'administration/css/admin_panel.css' %}" />
{% endblock %}

{% block content %}
  <div class="admin-container">
    <h1 class="admin-title">Administración</h1>

    <div class="admin-tabs">
      <a href="?tab=usuarios" class="admin-tab {% if active_tab == 'usuarios' %}active{% endif %}">Usuarios</a>
      <a href="?tab=cursos" class="admin-tab {% if active_tab == 'cursos' %}active{% endif %}">Cursos</a>
      <a href="?tab=rutas" class="admin-tab {% if active_tab == 'rutas' %}active{% endif %}">Rutas</a>
      <a href="?tab=estadisticas" class="admin-tab {% if active_tab == 'estadisticas' %}active{% endif %}">Estadísticas</a>
    </div>

    <!-- USUARIOS -->
    {% if active_tab == 'usuarios' %}
      <div class="section-header">
        <h2>Gestión de usuarios</h2>
        <a class="btn-nuevo">Nuevo usuario</a>
      </div>

      <div class="tab-panel">
        <table class="table">
          <thead>
            <tr>
              <th style="width:80px">ID</th>
              <th>Nombre</th>
              <th>Email</th>
              <th>Rol</th>
              <th style="width:140px"></th>
            </tr>
          </thead>
          <tbody>
            {% for u in usuarios %}
              <tr>
                <td>{{ u.id }}</td>
                <td>{{ u.username }}</td>
                <td>{{ u.email }}</td>
                <td>
                  <form method="post" action="{% url 'user_change_role' u.id %}">
                    {% csrf_token %}
                    <select name="role" class="role-select">
                      {% for value, label in role_choices %}
                        <option value="{{ value }}" {% if u.role == value %}selected{% endif %}>{{ label }}</option>
                      {% endfor %}
                    </select>
                    <button type="submit" class="btn-secondary">Actualizar</button>
                  </form>
                </td>
                <td>
                  <form method="post" action="{% url 'user_del' u.id %}" style="display:inline">
                    {% csrf_token %}
                    <button type="submit" class="btn-danger" onclick="return confirm('¿Eliminar {{ u.username }}?')">Eliminar</button>
                  </form>
                </td>
              </tr>
            {% empty %}
              <tr>
                <td class="empty" colspan="5">Sin usuarios</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}

    <!-- CURSOS -->
    {% if active_tab == 'cursos' %}
      <div class="section-header">
        <h2>Cursos disponibles</h2>
        <a href="{% url 'course_create' %}" class="btn-primary">Nuevo</a>
      </div>

      {% if courses %}
        <div class="courses-grid">
          {% for course in courses %}
            <div class="course-card">
              <div class="course-header">
                <!-- Aca poner el renderizado de la imagen -->
              </div>
              <div class="course-body">
                <div class="course-title-row">
                  <h3>{{ course.name }}</h3>
                  <span class="badge badge-{{ course.status }}">{{ course.get_status_display }}</span>
                </div>
                <p class="course-description">{{ course.description|default:'Sin descripción' }}</p>
                <div class="course-meta">
                  <span>{{ course.duration_hours|default:'--' }}h</span>
                  <span>{{ course.modules.count }} módulos</span>
                </div>
                <div class="course-actions">
                  <a href="{% url 'course_detail' course.pk %}" class="btn-secondary">Ver</a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="empty-state">
          <p>No hay cursos creados</p>
          <a href="{% url 'course_create' %}" class="btn-primary">Crear primer curso</a>
        </div>
      {% endif %}
    {% endif %}

    <!-- RUTAS -->
    {% if active_tab == 'rutas' %}
      <div class="section-header">
        <h2>Rutas de aprendizaje</h2>
        <a href="{% url 'path_create' %}" class="btn-primary">Nueva ruta</a>
      </div>

      {% if learning_paths %}
        <div class="courses-grid">
          {% for path in learning_paths %}
            <div class="course-card">
              <div class="course-body">
                <div class="course-title-row">
                  <h3>{{ path.name }}</h3>
                  <span class="badge badge-{{ path.status }}">{{ path.get_status_display }}</span>
                </div>
                <p class="course-description">{{ path.description|default:'Sin descripción' }}</p>
                <div class="course-meta">
                  <span>{{ path.estimated_duration|default:'--' }}h</span>
                  <span>{{ path.courses.count }} cursos</span>
                </div>
                <div class="course-actions">
                  <a href="{% url 'path_detail' path.pk %}" class="btn-secondary">Ver</a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="empty-state">
          <p>No hay rutas creadas</p>
          <a href="{% url 'path_create' %}" class="btn-primary">Crear primer ruta</a>
        </div>
      {% endif %}
    {% endif %}

    <!-- ESTADÍSTICAS -->
    {% if active_tab == 'estadisticas' %}
      <div class="section-header">
        <h2>Estadísticas y KPIs</h2>
      </div>
      <div>
        <div class="empty-state">Gráficos y estadísticas aquí</div>
      </div>
    {% endif %}
  </div>
{% endblock %}
